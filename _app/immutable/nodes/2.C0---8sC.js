import"../chunks/CWj6FrbW.js";import{i as Fe}from"../chunks/Usnw30qw.js";import{B as ue,w as H,a6 as We,ag as Ke,x as Ge,v as Ye,h as l,O as $e,y as Ve,z as Je,A as me,C as fe,I as j,a7 as Qe,aa as Xe,D as Pe,F as Ie,G as Ze,ae as Ne,a4 as Oe,as as L,aw as we,ax as ce,a1 as le,ay as je,az as et,aA as tt,ad as at,aB as nt,aC as rt,aD as it,aE as ot,a8 as st,J as Le,a2 as lt,aF as dt,aG as ut,aH as ft,aI as ct,aJ as vt,aK as _t,aL as pt,E as ht,aM as gt,aN as yt,e as ve,aO as mt,aP as wt,L as bt,aQ as ee,_ as be,$ as Ee,a0 as Et,p as Ce,l as V,f as Re,a as Y,m as De,R as S,n as D,aR as ke,o as R,q as U,aS as xe,t as oe,aT as kt}from"../chunks/B2grx4uu.js";import{b as _e,i as se,p as Ae}from"../chunks/RakwwYcg.js";import{l as xt,a as At,b as St,w as Tt,c as Mt,o as qe,e as J,s as te,d as Ft}from"../chunks/Bk3dV10k.js";function $t(t,e){return e}function Pt(t,e,a,r){for(var o=[],i=e.length,s=0;s<i;s++)tt(e[s].e,o,!0);var c=i>0&&o.length===0&&a!==null;if(c){var p=a.parentNode;at(p),p.append(a),r.clear(),W(t,e[0].prev,e[i-1].next)}nt(o,()=>{for(var u=0;u<i;u++){var n=e[u];c||(r.delete(n.k),W(t,n.prev,n.next)),rt(n.e,!c)}})}function It(t,e,a,r,o,i=null){var s=t,c={flags:e,items:new Map,first:null};{var p=t;s=H?ue(We(p)):p.appendChild(Ke())}H&&Ge();var u=null,n=!1,w=$e(()=>{var v=a();return Oe(v)?v:v==null?[]:Ne(v)});Ye(()=>{var v=l(w),y=v.length;if(n&&y===0)return;n=y===0;let _=!1;if(H){var m=Ve(s)===Je;m!==(y===0)&&(s=me(),ue(s),fe(!1),_=!0)}if(H){for(var b=null,d,E=0;E<y;E++){if(j.nodeType===Qe&&j.data===Xe){s=j,_=!0,fe(!1);break}var F=v[E],$=r(F,E);d=ze(j,c,b,null,F,$,E,o,e,a),c.items.set($,d),b=d}y>0&&ue(me())}H||Nt(v,c,s,o,e,r,a),i!==null&&(y===0?u?Pe(u):u=Ie(()=>i(s)):u!==null&&Ze(u,()=>{u=null})),_&&fe(!0),l(w)}),H&&(s=j)}function Nt(t,e,a,r,o,i,s){var c=t.length,p=e.items,u=e.first,n=u,w,v=null,y=[],_=[],m,b,d,E;for(E=0;E<c;E+=1){if(m=t[E],b=i(m,E),d=p.get(b),d===void 0){var F=n?n.e.nodes_start:a;v=ze(F,e,v,v===null?e.first:v.next,m,b,E,r,o,s),p.set(b,v),y=[],_=[],n=v.next;continue}if(Ot(d,m,E),(d.e.f&ce)!==0&&Pe(d.e),d!==n){if(w!==void 0&&w.has(d)){if(y.length<_.length){var $=_[0],M;v=$.prev;var C=y[0],N=y[y.length-1];for(M=0;M<y.length;M+=1)Se(y[M],$,a);for(M=0;M<_.length;M+=1)w.delete(_[M]);W(e,C.prev,N.next),W(e,v,C),W(e,N,$),n=$,v=N,E-=1,y=[],_=[]}else w.delete(d),Se(d,n,a),W(e,d.prev,d.next),W(e,d,v===null?e.first:v.next),W(e,v,d),v=d;continue}for(y=[],_=[];n!==null&&n.k!==b;)(n.e.f&ce)===0&&(w??(w=new Set)).add(n),_.push(n),n=n.next;if(n===null)continue;d=n}y.push(d),v=d,n=d.next}if(n!==null||w!==void 0){for(var h=w===void 0?[]:Ne(w);n!==null;)(n.e.f&ce)===0&&h.push(n),n=n.next;var O=h.length;if(O>0){var K=c===0?a:null;Pt(e,h,K,p)}}le.first=e.first&&e.first.e,le.last=v&&v.e}function Ot(t,e,a,r){et(t.v,e),t.i=a}function ze(t,e,a,r,o,i,s,c,p,u){var n=(p&it)!==0,w=(p&ot)===0,v=n?w?L(o,!1,!1):we(o):o,y=(p&je)===0?s:we(s),_={i:y,v,k:i,a:null,e:null,prev:a,next:r};try{return _.e=Ie(()=>c(t,v,y,u),H),_.e.prev=a&&a.e,_.e.next=r&&r.e,a===null?e.first=_:(a.next=_,a.e.next=_.e),r!==null&&(r.prev=_,r.e.prev=_.e),_}finally{}}function Se(t,e,a){for(var r=t.next?t.next.e.nodes_start:a,o=e?e.e.nodes_start:a,i=t.e.nodes_start;i!==r;){var s=st(i);o.before(i),i=s}}function W(t,e,a){e===null?t.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}function Ue(t,e,a=!1){if(t.multiple){if(e==null)return;if(!Oe(e))return dt();for(var r of t.options)r.selected=e.includes(ae(r));return}for(r of t.options){var o=ae(r);if(ut(o,e)){r.selected=!0;return}}(!a||e!==void 0)&&(t.selectedIndex=-1)}function Lt(t){var e=new MutationObserver(()=>{Ue(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),lt(()=>{e.disconnect()})}function Ct(t,e,a=e){var r=!0;xt(t,"change",o=>{var i=o?"[selected]":":checked",s;if(t.multiple)s=[].map.call(t.querySelectorAll(i),ae);else{var c=t.querySelector(i)??t.querySelector("option:not([disabled])");s=c&&ae(c)}a(s)}),Le(()=>{var o=e();if(Ue(t,o,r),r&&o===void 0){var i=t.querySelector(":checked");i!==null&&(o=ae(i),a(o))}t.__value=o,r=!1}),Lt(t)}function ae(t){return"__value"in t?t.__value:t.value}const Rt=Symbol("is custom element"),Dt=Symbol("is html");function qt(t){if(H){var e=!1,a=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var r=t.value;Q(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var o=t.checked;Q(t,"checked",null),t.checked=o}}};t.__on_r=a,ct(a),At()}}function zt(t,e){var a=He(t);a.value===(a.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function Q(t,e,a,r){var o=He(t);H&&(o[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||o[e]!==(o[e]=a)&&(e==="loading"&&(t[ft]=a),a==null?t.removeAttribute(e):typeof a!="string"&&Ut(t).includes(e)?t[e]=a:t.setAttribute(e,a))}function He(t){return t.__attributes??(t.__attributes={[Rt]:t.nodeName.includes("-"),[Dt]:t.namespaceURI===vt})}var Te=new Map;function Ut(t){var e=Te.get(t.nodeName);if(e)return e;Te.set(t.nodeName,e=[]);for(var a,r=t,o=Element.prototype;o!==r;){a=pt(r);for(var i in a)a[i].set&&e.push(i);r=_t(r)}return e}const Ht=()=>performance.now(),B={tick:t=>requestAnimationFrame(t),now:()=>Ht(),tasks:new Set};function Be(){const t=B.now();B.tasks.forEach(e=>{e.c(t)||(B.tasks.delete(e),e.f())}),B.tasks.size!==0&&B.tick(Be)}function Bt(t){let e;return B.tasks.size===0&&B.tick(Be),{promise:new Promise(a=>{B.tasks.add(e={c:t,f:a})}),abort(){B.tasks.delete(e)}}}function ie(t,e){Tt(()=>{t.dispatchEvent(new CustomEvent(e))})}function Wt(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function Me(t){const e={},a=t.split(";");for(const r of a){const[o,i]=r.split(":");if(!o||i===void 0)break;const s=Wt(o.trim());e[s]=i.trim()}return e}const Kt=t=>t;function Gt(t,e,a,r){var o=(t&mt)!==0,i="both",s,c=e.inert,p=e.style.overflow,u,n;function w(){var b=Et,d=le;be(null),Ee(null);try{return s??(s=a()(e,(r==null?void 0:r())??{},{direction:i}))}finally{be(b),Ee(d)}}var v={is_global:o,in(){e.inert=c,ie(e,"introstart"),u=pe(e,w(),n,1,()=>{ie(e,"introend"),u==null||u.abort(),u=s=void 0,e.style.overflow=p})},out(b){e.inert=!0,ie(e,"outrostart"),n=pe(e,w(),u,0,()=>{ie(e,"outroend"),b==null||b()})},stop:()=>{u==null||u.abort(),n==null||n.abort()}},y=le;if((y.transitions??(y.transitions=[])).push(v),St){var _=o;if(!_){for(var m=y.parent;m&&(m.f&ht)!==0;)for(;(m=m.parent)&&(m.f&gt)===0;);_=!m||(m.f&yt)!==0}_&&Le(()=>{ve(()=>v.in())})}}function pe(t,e,a,r,o){var i=r===1;if(wt(e)){var s,c=!1;return bt(()=>{if(!c){var b=e({direction:i?"in":"out"});s=pe(t,b,a,r,o)}}),{abort:()=>{c=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(a==null||a.deactivate(),!(e!=null&&e.duration))return o(),{abort:ee,deactivate:ee,reset:ee,t:()=>r};const{delay:p=0,css:u,tick:n,easing:w=Kt}=e;var v=[];if(i&&a===void 0&&(n&&n(0,1),u)){var y=Me(u(0,1));v.push(y,y)}var _=()=>1-r,m=t.animate(v,{duration:p,fill:"forwards"});return m.onfinish=()=>{m.cancel();var b=(a==null?void 0:a.t())??1-r;a==null||a.abort();var d=r-b,E=e.duration*Math.abs(d),F=[];if(E>0){var $=!1;if(u)for(var M=Math.ceil(E/16.666666666666668),C=0;C<=M;C+=1){var N=b+d*w(C/M),h=Me(u(N,1-N));F.push(h),$||($=h.overflow==="hidden")}$&&(t.style.overflow="hidden"),_=()=>{var O=m.currentTime;return b+d*w(O/E)},n&&Bt(()=>{if(m.playState!=="running")return!1;var O=_();return n(O,1-O),!0})}m=t.animate(F,{duration:E,fill:"forwards"}),m.onfinish=()=>{_=()=>r,n==null||n(r,1-r),o()}},{abort:()=>{m&&(m.cancel(),m.effect=null,m.onfinish=ee)},deactivate:()=>{o=ee},reset:()=>{r===0&&(n==null||n(1,0))},t:()=>_()}}const Yt=!0,Vt=!1,fa=Object.freeze(Object.defineProperty({__proto__:null,prerender:Yt,ssr:Vt},Symbol.toStringTag,{value:"Module"}));function Jt(t){const e=t-1;return e*e*e+1}function Qt(t,{delay:e=0,duration:a=400,easing:r=Jt,axis:o="y"}={}){const i=getComputedStyle(t),s=+i.opacity,c=o==="y"?"height":"width",p=parseFloat(i[c]),u=o==="y"?["top","bottom"]:["left","right"],n=u.map(d=>`${d[0].toUpperCase()}${d.slice(1)}`),w=parseFloat(i[`padding${n[0]}`]),v=parseFloat(i[`padding${n[1]}`]),y=parseFloat(i[`margin${n[0]}`]),_=parseFloat(i[`margin${n[1]}`]),m=parseFloat(i[`border${n[0]}Width`]),b=parseFloat(i[`border${n[1]}Width`]);return{delay:e,duration:a,easing:r,css:d=>`overflow: hidden;opacity: ${Math.min(d*20,1)*s};${c}: ${d*p}px;padding-${u[0]}: ${d*w}px;padding-${u[1]}: ${d*v}px;margin-${u[0]}: ${d*y}px;margin-${u[1]}: ${d*_}px;border-${u[0]}-width: ${d*m}px;border-${u[1]}-width: ${d*b}px;min-${c}: 0`}}var Xt=V('<button type="button" class="song-option svelte-bd6yko"> </button>'),Zt=V('<div id="song-dropdown" class="svelte-bd6yko"></div>'),jt=V('<div id="playlist-container" class="svelte-bd6yko"><button id="current-song" type="button" aria-haspopup="listbox" class="svelte-bd6yko"><div id="song-display" class="svelte-bd6yko"><span id="song-title-display"> </span></div> <span id="dropdown-button" aria-hidden="true" class="svelte-bd6yko">▼</span></button> <!></div>'),ea=V('<div id="animated-controls" class="svelte-bd6yko"><button class="control-btn svelte-bd6yko"> </button> <input type="range" min="0" class="svelte-bd6yko"/> <div id="time-display" class="svelte-bd6yko"> </div> <button class="control-btn svelte-bd6yko" title="Toggle Fullscreen"> </button></div>'),ta=V('<div id="upload-container" class="svelte-bd6yko"><input type="file" accept="audio/*" multiple id="file-input" class="svelte-bd6yko"/> <label for="file-input" class="custom-upload-btn svelte-bd6yko"><span>Upload Music</span></label></div> <!> <!> <audio></audio>',1);function aa(t,e){Ce(e,!1);const a=Mt();let r=L([]),o=L(null),i=L(),s=L(!1),c=L(0),p=L(0),u=L(),n=L(!1),w=L(!1);function v(){var x,k;const g=document.documentElement;document.fullscreenElement?(k=document.exitFullscreen)==null||k.call(document).then(()=>{S(w,!1)}):(x=g.requestFullscreen)==null||x.call(g).then(()=>{S(w,!0)}).catch(P=>{console.warn("Fullscreen failed:",P)})}function y(g){const k=Array.from(g.target.files).map(P=>({name:P.name,url:URL.createObjectURL(P),file:P}));S(r,[...l(r),...k]),!l(o)&&l(r).length>0&&b(l(r)[0])}function _(){S(n,!l(n))}function m(g){b(l(r)[g]),S(n,!1)}function b(g){var k;if(!l(i))return;((k=l(o))==null?void 0:k.url)!==g.url&&(S(o,g),xe(i,l(i).src=g.url),a("songChange",{song:g,audio:l(i)}));const x=()=>{l(i).play().then(()=>{S(s,!0)}).catch(P=>{console.warn("Play failed",P),S(s,!1)})};window.audioContext&&window.audioContext.state==="suspended"?window.audioContext.resume().then(()=>{x()}).catch(console.error):x()}function d(){if(!(!l(i)||!l(o)))if(l(s))l(i).pause(),S(s,!1);else{const g=()=>{l(i).play().then(()=>{S(s,!0)}).catch(x=>{console.warn("Play failed",x),S(s,!1)})};window.audioContext&&window.audioContext.state==="suspended"?window.audioContext.resume().then(()=>{g()}).catch(console.error):g()}}function E(g){l(i)&&xe(i,l(i).currentTime=g.target.value)}function F(g){const x=Math.floor(g/60),k=Math.floor(g%60).toString().padStart(2,"0");return`${x}:${k}`}qe(()=>{l(i).addEventListener("timeupdate",()=>{S(c,l(i).currentTime),S(p,l(i).duration||0)})}),Fe();var $=ta(),M=Re($),C=D(M);_e(C,g=>S(u,g),()=>l(u)),ke(2),R(M);var N=U(M,2);{var h=g=>{var x=jt(),k=D(x),P=D(k),q=D(P),A=D(q,!0);R(q),R(P),ke(2),R(k);var T=U(k,2);{var f=I=>{var z=Zt();It(z,5,()=>l(r),$t,(X,de,Z)=>{var G=Xt(),re=D(G,!0);R(G),oe(()=>te(re,l(de).name)),J("click",G,()=>m(Z)),Y(X,G)}),R(z),Y(I,z)};se(T,I=>{l(n)&&I(f)})}R(x),oe(()=>{Q(k,"aria-expanded",l(n)),te(A,l(o)?l(o).name:"Select a Song")}),J("click",k,_),Y(g,x)};se(N,g=>{l(r).length>0&&g(h)})}var O=U(N,2);{var K=g=>{var x=ea(),k=D(x),P=D(k,!0);R(k);var q=U(k,2);qt(q);var A=U(q,2),T=D(A);R(A);var f=U(A,2),I=D(f,!0);R(f),R(x),oe((z,X)=>{te(P,l(s)?"❚❚":"▶"),Q(q,"max",l(p)),zt(q,l(c)),te(T,`${z??""} / ${X??""}`),te(I,l(w)?"🡼":"⛶")},[()=>F(l(c)),()=>F(l(p))],$e),J("click",k,d),J("input",q,E),J("click",f,v),Gt(3,x,()=>Qt,()=>({duration:300})),Y(g,x)};se(O,g=>{l(o)&&g(K)})}var ne=U(O,2);_e(ne,g=>S(i,g),()=>l(i)),J("change",C,y),Y(t,$),De()}var na=V('<canvas style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;"></canvas>');function ra(t,e){Ce(e,!1);let a=Ae(e,"audioEl",8,null);Ae(e,"mode",8,"videoWaveform");let r=L(),o,i,s,c,p;const u=2048,n=200,w=.1,v=500,y=.1,_=.8,m=1e3,b=1.2;let d=new Array(n).fill(0),E=new Array(n).fill(0),F=[],$=0;function M(h,O,K){if(!o)return;o.getByteTimeDomainData(c);let ne=0,g=0,x=0;for(let f=0;f<c.length;f++){const I=Math.abs(c[f]-128);ne+=I,I>g&&(g=I,x=f)}const k=ne/c.length;if(k>$*b&&k>5){const f=x/c.length;F.push({position:f,intensity:1})}$=k,h.fillStyle="black",h.fillRect(0,0,O,K);const P=K/2,q=K/8;let A=[],T=[];for(let f=0;f<n;f++){const I=Math.floor(f*(c.length/n)),X=Math.abs(c[I]-128)/90*q;d[f]+=(X-d[f])*w;const de=f/(n-1);let Z=0;for(const he of F){const ge=Math.abs(de-he.position),ye=he.intensity*Math.exp(-(ge*ge*m));ye>Z&&(Z=ye)}E[f]+=(Z-E[f])*y;const G=d[f]+E[f]*v,re=f/(n-1)*O;A.push({x:re,y:P-G}),T.push({x:re,y:P+G})}h.beginPath(),h.moveTo(A[0].x,A[0].y);for(let f=1;f<A.length-1;f++){const I=(A[f].x+A[f+1].x)/2,z=(A[f].y+A[f+1].y)/2;h.quadraticCurveTo(A[f].x,A[f].y,I,z)}h.lineTo(A[A.length-1].x,A[A.length-1].y),h.lineTo(T[T.length-1].x,T[T.length-1].y);for(let f=T.length-2;f>0;f--){const I=(T[f].x+T[f-1].x)/2,z=(T[f].y+T[f-1].y)/2;h.quadraticCurveTo(T[f].x,T[f].y,I,z)}h.lineTo(T[0].x,T[0].y),h.closePath(),h.fillStyle="rgba(255, 255, 255, 0.1)",h.fill(),h.lineWidth=2,h.strokeStyle="rgba(255, 255, 255, 0.9)",h.stroke()}function C(){F.forEach(h=>h.intensity*=_),F=F.filter(h=>h.intensity>.01),i&&M(i,l(r).width,l(r).height),s=requestAnimationFrame(C)}qe(()=>{if(p=new(window.AudioContext||window.webkitAudioContext),i=l(r).getContext("2d"),a()){const O=p.createMediaElementSource(a());o=p.createAnalyser(),o.fftSize=u,o.smoothingTimeConstant=.8,c=new Uint8Array(o.fftSize),O.connect(o),o.connect(p.destination)}else console.warn("Audio element not provided to visualizer.");const h=()=>{p.state==="suspended"&&p.resume(),window.removeEventListener("click",h),window.removeEventListener("keydown",h)};window.addEventListener("click",h),window.addEventListener("keydown",h),C()}),Ft(()=>{cancelAnimationFrame(s),p&&p.state!=="closed"&&p.close()}),Fe();var N=na();Q(N,"width",ve(()=>window.innerWidth)),Q(N,"height",ve(()=>window.innerHeight)),_e(N,h=>S(r,h),()=>l(r)),Y(t,N),De()}var ia=V('<select style="position: fixed; top: 20px; right: 20px; z-index: 100;"><option>Waveform</option></select> <!> <!>',1);function ca(t){let e=L(null),a=L(null),r=L("videoWaveform");var o=ia(),i=Re(o);oe(()=>{l(r),kt(()=>{})});var s=D(i);s.value=s.__value="videoWaveform",R(i);var c=U(i,2);aa(c,{$$events:{songChange:n=>{S(e,n.detail.song),S(a,n.detail.audio)}}});var p=U(c,2);{var u=n=>{ra(n,{get audioEl(){return l(a)},get mode(){return l(r)}})};se(p,n=>{l(a)&&n(u)})}Ct(i,()=>l(r),n=>S(r,n)),Y(t,o)}export{ca as component,fa as universal};
